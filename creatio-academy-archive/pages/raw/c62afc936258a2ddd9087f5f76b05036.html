<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-8.2 docs-doc-page docs-doc-id-undefined" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.7.0"><title data-rh=true>Manage chats in Creatio | Creatio Academy</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:image content=https://academy.creatio.com/docs/8.x/dev/img/OG-Creatio-Docs.jpg><meta data-rh=true name=twitter:image content=https://academy.creatio.com/docs/8.x/dev/img/OG-Creatio-Docs.jpg><meta data-rh=true property=og:url content=https://academy.creatio.com/docs/8.x/dev/development-on-creatio-platform/8.2/platform-customization/freedom-ui/chat-management-api/overview><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docusaurus_version content=8.2><meta data-rh=true name=docusaurus_tag content=docs-default-8.2><meta data-rh=true name=docsearch:version content=8.2><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-8.2><meta data-rh=true property=og:title content="Manage chats in Creatio | Creatio Academy"><meta data-rh=true name=description content="The pre-installed OmnichannelMessaging package contains the basic functionality that lets you manage chats. Before using functionality, set up chat processing. Instructions: Set up chat processing (user documentation)."><meta data-rh=true property=og:description content="The pre-installed OmnichannelMessaging package contains the basic functionality that lets you manage chats. Before using functionality, set up chat processing. Instructions: Set up chat processing (user documentation)."><link data-rh=true rel=icon href=/docs/8.x/dev/img/favicon.ico><link data-rh=true rel=canonical href=https://academy.creatio.com/docs/8.x/dev/development-on-creatio-platform/8.2/platform-customization/freedom-ui/chat-management-api/overview><link data-rh=true rel=alternate href=https://academy.creatio.com/docs/8.x/dev/development-on-creatio-platform/8.2/platform-customization/freedom-ui/chat-management-api/overview hreflang=en><link data-rh=true rel=alternate href=https://academy.creatio.com/docs/8.x/dev/development-on-creatio-platform/8.2/platform-customization/freedom-ui/chat-management-api/overview hreflang=x-default><link rel=preconnect href=https://www.googletagmanager.com><script>window.dataLayer=window.dataLayer||[],function(e,t,a,n,r){e[n]=e[n]||[],e[n].push({"gtm.start":new Date().getTime(),event:"gtm.js"});var d=t.getElementsByTagName(a)[0],g=t.createElement(a);g.async=!0,g.src="https://www.googletagmanager.com/gtm.js?id="+r+("dataLayer"!=n?"&l="+n:""),d.parentNode.insertBefore(g,d)}(window,document,"script","dataLayer","GTM-5C6KM9TP")</script><link rel=stylesheet href=/docs/8.x/dev/assets/css/styles.89ecc891.css><script src=/docs/8.x/dev/assets/js/runtime~main.1fca6f6f.js defer></script><script src=/docs/8.x/dev/assets/js/main.020f5612.js defer></script><body class=navigation-with-keyboard><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5C6KM9TP" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript>


<script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><link rel=preload as=image href=/docs/8.x/dev/img/logo-white.svg><link rel=preload as=image href=/docs/8.x/dev/img/logo.svg><link rel=preload as=image href=/docs/8.x/dev/img/accelerate.svg><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><div class=navtop><div class=container-fluid><div class=navtop__content><div class=search><form method=get><input class=search__input type=text placeholder=Search name=search><input class=search__button type=submit value=Search></form><div class=search__toggle></div></div><ul class=sites><li class=sites__item><a href=https://www.creatio.com/ rel=nofollow target=_blank>Creatio</a><li class=sites__item><a href=https://community.creatio.com/ rel=nofollow target=_blank>Community</a><li class=sites__item><a href=https://marketplace.creatio.com/ rel=nofollow target=_blank>Marketplace</a><li class=sites__item><a href=https://knowledge-hub.creatio.com/ rel=nofollow target=_blank>Knowledge Hub</a></ul></div></div></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class="navbar__inner container-fluid"><div class=navbar__items><div class=navbar__toggle><span></span></div><a class="navbar__brand navbar__brand_mobile" href=/><img src=/docs/8.x/dev/img/logo-white.svg alt="Creatio Academy"></a><a class=navbar__brand href=/><img src=/docs/8.x/dev/img/logo.svg alt="Creatio Academy"></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/docs/8.x/dev/>Guides</a><a href=https://academy.creatio.com/e-learning target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">E-learning</a><a href=https://academy.creatio.com/training target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">Training</a><a href=https://academy.creatio.com/certification target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">Certification</a><div class="navbar__item dropdown dropdown--hoverable"><a aria-current=page class="navbar__link active" aria-haspopup=true aria-expanded=false role=button href=/docs/8.x/dev/development-on-creatio-platform/8.2/platform-customization/freedom-ui/chat-management-api/overview>8.2</a><ul class=dropdown__menu><li><a class=dropdown__link href=/docs/8.x/dev/development-on-creatio-platform/platform-customization/freedom-ui/chat-management-api/overview>8.3</a><li><a aria-current=page class="dropdown__link dropdown__link--active" href=/docs/8.x/dev/development-on-creatio-platform/8.2/platform-customization/freedom-ui/chat-management-api/overview>8.2</a><li><a class=dropdown__link href=/docs/8.x/dev/development-on-creatio-platform/8.1/getting-started/development-recommendations>8.1</a><li><a class=dropdown__link href=/docs/8.x/dev/development-on-creatio-platform/8.0/getting-started/development-recommendations>8.0</a></ul></div></div><div class="navbar__items navbar__items--right"><div class=search><form method=get><input class=search__input type=text placeholder=Search name=search><input class=search__button type=submit value=Search></form><div class=search__toggle></div></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_bSxm><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=container-fluid><div class=docRoot_cWv0><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class="doc-menu sidebar_mhZE"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/8.x/dev/development-on-creatio-platform/8.2/category/getting-started>Getting started</a><button aria-label="Expand sidebar category 'Getting started'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/8.x/dev/development-on-creatio-platform/8.2/category/architecture>Architecture</a><button aria-label="Expand sidebar category 'Architecture'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/8.x/dev/development-on-creatio-platform/8.2/category/development-tools>Development tools</a><button aria-label="Expand sidebar category 'Development tools'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/8.x/dev/development-on-creatio-platform/8.2/category/back-end-development>Back-end development</a><button aria-label="Expand sidebar category 'Back-end development'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/8.x/dev/development-on-creatio-platform/8.2/category/front-end-development>Front-end development</a><button aria-label="Expand sidebar category 'Front-end development'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/docs/8.x/dev/development-on-creatio-platform/8.2/category/platform-customization>Platform customization</a><button aria-label="Collapse sidebar category 'Platform customization'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/docs/8.x/dev/development-on-creatio-platform/8.2/freedom-ui-customization>Freedom UI</a><button aria-label="Collapse sidebar category 'Freedom UI'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/8.x/dev/development-on-creatio-platform/8.2/category/page-customization>Page customization</a><button aria-label="Expand sidebar category 'Page customization'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/8.x/dev/development-on-creatio-platform/8.2/category/creatio-ai>Creatio AI</a><button aria-label="Expand sidebar category 'Creatio AI'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/8.x/dev/development-on-creatio-platform/8.2/category/field>Field</a><button aria-label="Expand sidebar category 'Field'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/8.x/dev/development-on-creatio-platform/8.2/platform-customization/freedom-ui/toggle-panel>Toggle panel</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/8.x/dev/development-on-creatio-platform/8.2/platform-customization/freedom-ui/overview>Timeline</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/8.x/dev/development-on-creatio-platform/8.2/category/communication-options>Communication options</a><button aria-label="Expand sidebar category 'Communication options'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/8.x/dev/development-on-creatio-platform/8.2/category/sidebar>Sidebar</a><button aria-label="Expand sidebar category 'Sidebar'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/8.x/dev/development-on-creatio-platform/8.2/category/selection-window>Selection window</a><button aria-label="Expand sidebar category 'Selection window'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/8.x/dev/development-on-creatio-platform/8.2/category/dialog-window>Dialog window</a><button aria-label="Expand sidebar category 'Dialog window'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/8.x/dev/development-on-creatio-platform/8.2/category/system-variable>System variable</a><button aria-label="Expand sidebar category 'System variable'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/8.x/dev/development-on-creatio-platform/8.2/category/system-setting>System setting</a><button aria-label="Expand sidebar category 'System setting'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" tabindex=0 href=/docs/8.x/dev/development-on-creatio-platform/8.2/category/chats>Chats</a><button aria-label="Collapse sidebar category 'Chats'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/docs/8.x/dev/development-on-creatio-platform/8.2/platform-customization/freedom-ui/chat-management-api/overview>Overview</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/8.x/dev/development-on-creatio-platform/8.2/chat-references>References</a><button aria-label="Expand sidebar category 'References'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/8.x/dev/development-on-creatio-platform/8.2/category/word-reports>Word reports</a><button aria-label="Expand sidebar category 'Word reports'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/8.x/dev/development-on-creatio-platform/8.2/category/emails>Emails</a><button aria-label="Expand sidebar category 'Emails'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/8.x/dev/development-on-creatio-platform/8.2/category/web-service>Web service</a><button aria-label="Expand sidebar category 'Web service'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/8.x/dev/development-on-creatio-platform/8.2/category/additional-feature>Additional feature</a><button aria-label="Expand sidebar category 'Additional feature'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/8.x/dev/development-on-creatio-platform/8.2/platform-customization/freedom-ui/user-consents>User consent storage</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/8.x/dev/development-on-creatio-platform/8.2/category/open-page>Open page</a><button aria-label="Expand sidebar category 'Open page'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/8.x/dev/development-on-creatio-platform/8.2/platform-customization/freedom-ui/business-rules-of-collection-records>Business rules</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/8.x/dev/development-on-creatio-platform/8.2/platform-customization/freedom-ui/business-processes>Business processes</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/8.x/dev/development-on-creatio-platform/8.2/category/creatio-zone>Creatio zone</a><button aria-label="Expand sidebar category 'Creatio zone'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/8.x/dev/development-on-creatio-platform/8.2/platform-customization/freedom-ui/close-the-websocket>Closing the WebSocket</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/8.x/dev/development-on-creatio-platform/8.2/category/classic-ui-1>Classic UI</a><button aria-label="Expand sidebar category 'Classic UI'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/8.x/dev/development-on-creatio-platform/8.2/category/interface-control-tools>Interface control tools</a><button aria-label="Expand sidebar category 'Interface control tools'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/8.x/dev/development-on-creatio-platform/8.2/category/integrations-tools>Integrations tools</a><button aria-label="Expand sidebar category 'Integrations tools'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/8.x/dev/development-on-creatio-platform/8.2/category/mobile-app-development>Mobile app development</a><button aria-label="Expand sidebar category 'Mobile app development'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_z5aJ"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role=alert><div>This is documentation for Creatio <b>8.2</b>.</div><div class=margin-top--md>For up-to-date documentation, see the <b><a href=/docs/8.x/dev/development-on-creatio-platform/platform-customization/freedom-ui/chat-management-api/overview>latest version</a></b> (<!-- -->8.3<!-- -->).</div></div><div class=docItemContainer_c0TR><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/docs/8.x/dev/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/docs/8.x/dev/development-on-creatio-platform/8.2/category/platform-customization><span itemprop=name>Platform customization</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/docs/8.x/dev/development-on-creatio-platform/8.2/freedom-ui-customization><span itemprop=name>Freedom UI</span></a><meta itemprop=position content=2><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/docs/8.x/dev/development-on-creatio-platform/8.2/category/chats><span itemprop=name>Chats</span></a><meta itemprop=position content=3><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>Overview</span><meta itemprop=position content=4></ul></nav><div class=creatio-tags><div class=creatio-tags__content><span class="theme-doc-version-badge badge badge--secondary">Version: 8.2</span></div></div><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_bxCs"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Manage chats in Creatio</h1></header><div class=difficulty-level><span class=difficulty-level-intermediate>Level: <!-- -->intermediate</span></div>
<p>The pre-installed <code>OmnichannelMessaging</code> package contains the basic functionality that lets you manage chats. Before using functionality, set up chat processing. Instructions: <a href="https://academy.creatio.com/documents?ver=8.2&id=2382" target=_blank rel="noopener noreferrer">Set up chat processing</a> (user documentation).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=title-3480-1>Manage chat functionality in Creatio<a href=#title-3480-1 class=hash-link aria-label="Direct link to Manage chat functionality in Creatio" title="Direct link to Manage chat functionality in Creatio">​</a></h2>
<p>View the list of primary classes that let you manage chat functionality in the table below.</p>
<table><tr><th><p>Class<th><p>Description<tr><td><p>MessageManager<td><p>Enables the messenger integration with Creatio instance.<tr><td><p>FacebookOmnichannelMessagingService<td><p>Receives and sends messages from Facebook Messenger. The class is based on the <code>OmnichannelMessagingService</code> class that contains the set methods that are common for both Facebook Messenger and Telegram.<tr><td><p>TelegramOmnichannelMessagingService<td><p>Receives messages from Telegram. The class is based on the <code>OmnichannelMessagingService</code> class that contains the set methods that are common for both Facebook Messenger and Telegram.<tr><td><p>OmnichannelChatService<td><p>Receives history, chats of a specific agent, etc.<tr><td><p>OmnichannelOperatorService<td><p>Receives and changes the agent status.</table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=title-3480-16>Implement a custom channel provider<a href=#title-3480-16 class=hash-link aria-label="Direct link to Implement a custom channel provider" title="Direct link to Implement a custom channel provider">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=title-15621-1>1. Add a channel provider to Creatio<a href=#title-15621-1 class=hash-link aria-label="Direct link to 1. Add a channel provider to Creatio" title="Direct link to 1. Add a channel provider to Creatio">​</a></h3>
<ol>
<li>
<p><strong>Create a user-made package</strong> to add the channel provider. To do this, click <img decoding=async loading=lazy src=https://d3a7ykdi65m4cy.cloudfront.net/ac-en/s3fs-public/documentation/sdk/en/BPMonlineWebSDK/Screenshots/CreateConfigurationWebService/8.1/btn_create_a_package.png alt="" class=img_ev3q> → <strong>Create new package</strong> → fill out the package properties → <strong>Save</strong>.</p>
</li>
<li>
<p><strong>Change the current package</strong>. Instructions: <a href="https://academy.creatio.com/documents?ver=8.2&id=15072&anchor=change-the-current-package" target=_blank rel="noopener noreferrer">Change the current package</a>.</p>
</li>
<li>
<p><strong>Open the Lookups section</strong>. To do this, click <img decoding=async loading=lazy src=https://d3a7ykdi65m4cy.cloudfront.net/ac-en/s3fs-public/documentation/sdk/en/BPMonlineWebSDK/Screenshots/icons/8.2/btn_system_designer.png alt="" class=img_ev3q> in the top right → <strong>System setup</strong> → <strong>Lookups</strong>.</p>
</li>
<li>
<p><strong>Open the Channel provider lookup</strong>.</p>
</li>
<li>
<p><strong>Add the lookup value</strong>. To do this, click <strong>New</strong>.</p>
</li>
<li>
<p><strong>Fill out the properties</strong> of the lookup value.</p>
<p>View the example that adds the "Some custom channel provider" channel provider below.</p>
<table><tr><th><p>Property<th><p>Property value<tr><td><center><p>Name</center><td><center><p>Some custom channel provider</center></table>
</li>
<li>
<p><strong>Save the changes</strong>.</p>
</li>
</ol>
<p><strong>As a result</strong>, the custom channel provider will be added to Creatio.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=title-15621-2>2. Create a database table to store data of the custom channel provider<a href=#title-15621-2 class=hash-link aria-label="Direct link to 2. Create a database table to store data of the custom channel provider" title="Direct link to 2. Create a database table to store data of the custom channel provider">​</a></h3>
<p>Creatio uses one database table to store data of one channel provider. The structure of the database table depends on the provider and contains data to send and receive messages.</p>
<p>To create a database table, <strong>execute the SQL query</strong>.</p>
<div class="tabs-container tabList__CuJ"><ul role=tablist aria-orientation=horizontal class=tabs><li role=tab tabindex=0 aria-selected=true class="tabs__item tabItem_LNqP tabs__item--active">Microsoft SQL<li role=tab tabindex=-1 aria-selected=false class="tabs__item tabItem_LNqP">PostgreSQL</ul><div class=margin-top--md><div role=tabpanel class=tabItem_Ymn6><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_m3Ux><pre tabindex=0 class="prism-code language-sql codeBlock_qGQc thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_p187><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>IF</span><span class="token plain"> OBJECT_ID</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'SomeProviderMsgSettings'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>IS</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>NULL</span><span class="token plain"> </span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>BEGIN</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>CREATE</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>TABLE</span><span class="token plain"> SomeProviderMsgSettings</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        Id uniqueidentifier </span><span class="token operator" style=color:#393A34>NOT</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>NULL</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>DEFAULT</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">newid</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        Token nvarchar</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>250</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>NOT</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>NULL</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>DEFAULT</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>''</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        UserName nvarchar</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>250</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>NOT</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>NULL</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>DEFAULT</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>''</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>CONSTRAINT</span><span class="token plain"> PK_SomeProviderMsgSettings_Id </span><span class="token keyword" style=color:#00009f>PRIMARY</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>KEY</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>CLUSTERED</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">Id</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>END</span><br></span></code></pre><div class=buttonGroup_6DOT><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div></div><div role=tabpanel class=tabItem_Ymn6 hidden><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_m3Ux><pre tabindex=0 class="prism-code language-sql codeBlock_qGQc thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_p187><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>CREATE</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>TABLE</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>IF</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>NOT</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>EXISTS</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>public</span><span class="token punctuation" style=color:#393A34>.</span><span class="token string" style=color:#e3116c>"SomeProviderMsgSettings"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"> </span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token string" style=color:#e3116c>"Id"</span><span class="token plain"> uuid </span><span class="token operator" style=color:#393A34>NOT</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>NULL</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>DEFAULT</span><span class="token plain"> uuid_generate_v4</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token string" style=color:#e3116c>"Token"</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>character</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>varying</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>250</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>COLLATE</span><span class="token plain"> pg_catalog</span><span class="token punctuation" style=color:#393A34>.</span><span class="token string" style=color:#e3116c>"default"</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>NOT</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>NULL</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>DEFAULT</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>''</span><span class="token plain">::</span><span class="token keyword" style=color:#00009f>character</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>varying</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token string" style=color:#e3116c>"UserName"</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>character</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>varying</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>250</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>COLLATE</span><span class="token plain"> pg_catalog</span><span class="token punctuation" style=color:#393A34>.</span><span class="token string" style=color:#e3116c>"default"</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>NOT</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>NULL</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>DEFAULT</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>''</span><span class="token plain">::</span><span class="token keyword" style=color:#00009f>character</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>varying</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>CONSTRAINT</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"PK_SomeProviderMsgSettings_Id"</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>PRIMARY</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>KEY</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"Id"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre><div class=buttonGroup_6DOT><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div></div></div></div>
<p>Where <code>SomeProviderMsgSettings</code> is a template for the name of database table that will store data of the custom channel provider whose name is <code>SomeProvider</code>.</p>
<p><strong>As a result</strong>, the database table that stores data of the custom channel provider will be created.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=title-15621-3>3. Register the custom channel provider in the database<a href=#title-15621-3 class=hash-link aria-label="Direct link to 3. Register the custom channel provider in the database" title="Direct link to 3. Register the custom channel provider in the database">​</a></h3>
<p>To do this, <strong>add a record to the</strong> <code>Channel</code> <strong>database table</strong> that stores a list of all channel providers. View the primary columns of the <code>Channel</code> database table below.</p>
<table><tr><th><p>Column<th><p>Description<tr><td><p>Name<td><p>The channel name.<tr><td><p>ProviderId<td><p>The custom provider ID.<tr><td><p>MsgSettingsId<td><p>The record ID from the database table that stores data of custom channel provider.<tr><td><p>Source<td><p>The channel ID from the messenger. For example, <code>Facebook page ID</code>, <code>Telegram client ID</code>. The property value lets you identify the recipient by a messenger message.</table>
<p><strong>As a result</strong>, the custom channel provider will be registered in the database.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=title-15621-4>4. Implement a custom web service that receives messages<a href=#title-15621-4 class=hash-link aria-label="Direct link to 4. Implement a custom web service that receives messages" title="Direct link to 4. Implement a custom web service that receives messages">​</a></h3>
<ol>
<li>
<p><strong>Create the source code schema</strong>. Instructions: <a href="https://academy.creatio.com/documents?ver=8.2&id=15108&anchor=title-2123-8" target=_blank rel="noopener noreferrer">Implement the source code</a>.</p>
</li>
<li>
<p><strong>Create a service class</strong>.</p>
<ol>
<li>Add the <code>Terrasoft.Configuration.Omnichannel.Messaging</code> namespace.</li>
<li>Add the namespaces the data types of which to utilize in the class using the <code>using</code> directive.</li>
<li>Add a class name that matches the schema name (the <strong>Code</strong> property).</li>
<li>Specify the <code>OmnichannelMessagingService</code> class as a parent class.</li>
<li>Add the <code>[ServiceContract]</code> and <code>[AspNetCompatibilityRequirements(RequirementsMode = AspNetCompatibilityRequirementsMode.Required)]</code> attributes to the class.</li>
</ol>
</li>
<li>
<p><strong>Implement a class method</strong>.</p>
<p>Add the <code>public void ReceiveMessage(SomeProviderIncomingMessage message)</code> method that implements the endpoint of the custom web service. The messenger sends a message to the <code>receive</code> endpoint.</p>
<div class="language-cs codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockTitle_P25_>SomeProviderOmnichannelMessagingService</div><div class=codeBlockContent_m3Ux><pre tabindex=0 class="prism-code language-cs codeBlock_qGQc thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_p187><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>namespace</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>Terrasoft</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Configuration</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Omnichannel</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Messaging</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>System</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>System</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>ServiceModel</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>System</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>ServiceModel</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Activation</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>System</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>ServiceModel</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Web</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>Terrasoft</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Common</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>Terrasoft</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Core</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>Terrasoft</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Core</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>DB</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>Terrasoft</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Web</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Common</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>ServiceRouting</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>region</span><span class="token preprocessor property" style=color:#36acaa> Class: SomeProviderOmnichannelMessagingService</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">ServiceContract</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>[</span><span class="token attribute class-name">AspNetCompatibilityRequirements</span><span class="token attribute attribute-arguments punctuation" style=color:#393A34>(</span><span class="token attribute attribute-arguments">RequirementsMode </span><span class="token attribute attribute-arguments operator" style=color:#393A34>=</span><span class="token attribute attribute-arguments"> AspNetCompatibilityRequirementsMode</span><span class="token attribute attribute-arguments punctuation" style=color:#393A34>.</span><span class="token attribute attribute-arguments">Required</span><span class="token attribute attribute-arguments punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>[</span><span class="token attribute class-name">DefaultServiceRoute</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>public</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>class</span><span class="token plain"> </span><span class="token class-name">SomeProviderOmnichannelMessagingService</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token type-list class-name">OmnichannelMessagingService</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>region</span><span class="token preprocessor property" style=color:#36acaa> Constructors: Public</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>public</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>SomeProviderIncomingMessage</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>base</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token comment" style=color:#999988;font-style:italic>/* Initialize a new "SomeProviderIncomingMessage" class instance. */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>public</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>SomeProviderIncomingMessage</span><span class="token punctuation" style=color:#393A34>(</span><span class="token class-name">UserConnection</span><span class="token plain"> userConnection</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>base</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">userConnection</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>endregion</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>region</span><span class="token preprocessor property" style=color:#36acaa> Methods: Private</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>private</span><span class="token plain"> </span><span class="token return-type class-name keyword" style=color:#00009f>void</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>GetChannelAndQueueBySource</span><span class="token punctuation" style=color:#393A34>(</span><span class="token class-name">MessagingMessage</span><span class="token plain"> message</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token class-name">Select</span><span class="token plain"> channelSelect </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">Select</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">UserConnection</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                </span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Top</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Column</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"Id"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                </span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Column</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"ChatQueueId"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                </span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>From</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"Channel"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                </span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Where</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"Source"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>IsEqual</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">Column</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Parameter</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">message</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Recipient</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                </span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>And</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"IsActive"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>IsEqual</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">Column</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Parameter</span><span class="token punctuation" style=color:#393A34>(</span><span class="token boolean" style=color:#36acaa>true</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>as</span><span class="token plain"> </span><span class="token class-name">Select</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain">               </span><br></span><span class=token-line style=color:#393A34><span class="token plain">            channelSelect</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>ExecuteReader</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">reader </span><span class="token operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                message</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">ChannelId </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> reader</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>GetColumnValue</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"Id"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>ToString</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                message</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">ChannelQueueId </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> reader</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>GetColumnValue</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"ChatQueueId"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>endregion</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>region</span><span class="token preprocessor property" style=color:#36acaa> Methods: Public</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token comment" style=color:#999988;font-style:italic>/* The method that receives messages from the integration API. */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>[</span><span class="token attribute class-name">OperationContract</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>[</span><span class="token attribute class-name">WebInvoke</span><span class="token attribute attribute-arguments punctuation" style=color:#393A34>(</span><span class="token attribute attribute-arguments">UriTemplate </span><span class="token attribute attribute-arguments operator" style=color:#393A34>=</span><span class="token attribute attribute-arguments"> </span><span class="token attribute attribute-arguments string" style=color:#e3116c>"receive"</span><span class="token attribute attribute-arguments punctuation" style=color:#393A34>,</span><span class="token attribute attribute-arguments"> Method </span><span class="token attribute attribute-arguments operator" style=color:#393A34>=</span><span class="token attribute attribute-arguments"> </span><span class="token attribute attribute-arguments string" style=color:#e3116c>"POST"</span><span class="token attribute attribute-arguments punctuation" style=color:#393A34>,</span><span class="token attribute attribute-arguments"> RequestFormat </span><span class="token attribute attribute-arguments operator" style=color:#393A34>=</span><span class="token attribute attribute-arguments"> WebMessageFormat</span><span class="token attribute attribute-arguments punctuation" style=color:#393A34>.</span><span class="token attribute attribute-arguments">Json</span><span class="token attribute attribute-arguments punctuation" style=color:#393A34>,</span><span class="token attribute attribute-arguments"> BodyStyle </span><span class="token attribute attribute-arguments operator" style=color:#393A34>=</span><span class="token attribute attribute-arguments"> WebMessageBodyStyle</span><span class="token attribute attribute-arguments punctuation" style=color:#393A34>.</span><span class="token attribute attribute-arguments">Bare</span><span class="token attribute attribute-arguments punctuation" style=color:#393A34>,</span><span class="token attribute attribute-arguments"> ResponseFormat </span><span class="token attribute attribute-arguments operator" style=color:#393A34>=</span><span class="token attribute attribute-arguments"> WebMessageFormat</span><span class="token attribute attribute-arguments punctuation" style=color:#393A34>.</span><span class="token attribute attribute-arguments">Json</span><span class="token attribute attribute-arguments punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style=color:#00009f>void</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>ReceiveMessage</span><span class="token punctuation" style=color:#393A34>(</span><span class="token class-name">SomeProviderIncomingMessage</span><span class="token plain"> message</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token comment" style=color:#999988;font-style:italic>/* Convert the message. */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token class-name">MessagingMessage</span><span class="token plain"> messagingMessage </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">MessagingMessage</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">SomeProviderIncomingMessageConverter</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Convert</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">message</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token comment" style=color:#999988;font-style:italic>/* Identify the channel using the "Source" database field. */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token function" style=color:#d73a49>GetChannelAndQueueBySource</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">messagingMessage</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token comment" style=color:#999988;font-style:italic>/* If an open chat with this user is not found, create a new chat. Otherwise, add a message to an existing chat. If the user contacts you for the first time, create a contact and fill out their credentials. Otherwise, bind the chat to an existing contact. */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token function" style=color:#d73a49>InternalReceive</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">messagingMessage</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>endregion</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>endregion</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre><div class=buttonGroup_6DOT><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Publish the schema</strong>.</p>
</li>
</ol>
<p><strong>As a result</strong>, a custom web service that receives messages will be implemented.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=title-15621-5>5. Handle an incoming message<a href=#title-15621-5 class=hash-link aria-label="Direct link to 5. Handle an incoming message" title="Direct link to 5. Handle an incoming message">​</a></h3>
<p>Since Creatio attempts to handle incoming messages in the unified format, implement conversion of incoming messages to unified format. To do this:</p>
<ol>
<li>
<p><strong>Create the source code schema</strong>. Instructions: <a href="https://academy.creatio.com/documents?ver=8.2&id=15108&anchor=title-2123-8" target=_blank rel="noopener noreferrer">Implement the source code</a>.</p>
</li>
<li>
<p><strong>Implement the business logic</strong> that handles incoming messages using the <code>SomeProviderIncomingMessageConverter</code> class. The class converts a message that has the <code>SomeProviderIncomingMessage</code> type to the message with the <code>MessagingMessage</code> type.</p>
<div class="language-cs codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockTitle_P25_>SomeProviderIncomingMessageConverter</div><div class=codeBlockContent_m3Ux><pre tabindex=0 class="prism-code language-cs codeBlock_qGQc thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_p187><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>namespace</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>Terrasoft</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Configuration</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Omnichannel</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Messaging</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>OmnichannelProviders</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Domain</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Entities</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>System</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>System</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Collections</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Generic</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>public</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>class</span><span class="token plain"> </span><span class="token class-name">SomeProviderIncomingMessage</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token type-list class-name">UnifiedMessage</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>public</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>static</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>class</span><span class="token plain"> </span><span class="token class-name">SomeProviderIncomingMessageConverter</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>region</span><span class="token preprocessor property" style=color:#36acaa> Methods: Public </span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>public</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>static</span><span class="token plain"> </span><span class="token return-type class-name">MessagingMessage</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>Convert</span><span class="token punctuation" style=color:#393A34>(</span><span class="token class-name">SomeProviderIncomingMessage</span><span class="token plain"> message</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token class-name keyword" style=color:#00009f>var</span><span class="token plain"> messageType </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> MessageType</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Text</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token class-name keyword" style=color:#00009f>var</span><span class="token plain"> messageId </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> Guid</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>NewGuid</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token class-name keyword" style=color:#00009f>var</span><span class="token plain"> result </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">MessagingMessage</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                Id </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> messageId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                Message </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> message</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Message</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                </span><span class="token comment" style=color:#999988;font-style:italic>/* The message recipient is the ID of the page or client added to "Source" column in the "Channel" database table. */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                Recipient </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> message</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Recipient</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                </span><span class="token comment" style=color:#999988;font-style:italic>/* The ID of the message sender in the messenger. The sender is bound to the contact via the "ContactIdentity"]" database table. */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                Sender </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> message</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Sender</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                Timestamp </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> message</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Timestamp</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                </span><span class="token comment" style=color:#999988;font-style:italic>/* The channel ID in Creatio specified in the "MsgSettingsid" object field. */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                ChannelId </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> message</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">ChannelId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                MessageDirection </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> MessageDirection</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Incoming</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                MessageType </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> messageType</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                </span><span class="token comment" style=color:#999988;font-style:italic>/* The channel source. */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                Source </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> ChannelType</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">ThirdParty</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                </span><span class="token comment" style=color:#999988;font-style:italic>/* The provider name that is used as the provider ID. */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                ChannelName </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"SomeProvider"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">messageType </span><span class="token operator" style=color:#393A34>!=</span><span class="token plain"> MessageType</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Text</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                </span><span class="token comment" style=color:#999988;font-style:italic>/* The "Attachments" block is populated depending on the file access format provided by the messenger. In this case, it is a link to download. Fill out the "FileId" parameter value in the message to make the file available for download. */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                result</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Attachments </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">List</span><span class="token constructor-invocation class-name punctuation" style=color:#393A34>&lt;</span><span class="token constructor-invocation class-name">MessageAttachment</span><span class="token constructor-invocation class-name punctuation" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                </span><span class="token keyword" style=color:#00009f>foreach</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token class-name keyword" style=color:#00009f>var</span><span class="token plain"> attachment </span><span class="token keyword" style=color:#00009f>in</span><span class="token plain"> message</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Attachments</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                    result</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Attachments</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Add</span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">MessageAttachment</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                        MessageId </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> messageId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                        UploadUrl </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> attachment</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">UploadUrl</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                        FileType </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> attachment</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">FileType</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> result</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>endregion</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre><div class=buttonGroup_6DOT><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Publish the schema</strong>.</p>
</li>
</ol>
<p><strong>As a result</strong>, incoming messages will be converted to the unified format that Creatio attempts to handle.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=title-15621-6>6. Implement retrieval of sender data<a href=#title-15621-6 class=hash-link aria-label="Direct link to 6. Implement retrieval of sender data" title="Direct link to 6. Implement retrieval of sender data">​</a></h3>
<p>Messengers provide an API to retrieve sender data. To do this:</p>
<ol>
<li>
<p><strong>Create the source code schema</strong>. Instructions: <a href="https://academy.creatio.com/documents?ver=8.2&id=15108&anchor=title-2123-8" target=_blank rel="noopener noreferrer">Implement the source code</a>.</p>
</li>
<li>
<p><strong>Implement the business logic</strong> that retrieves sender data using the <code>IProfileDataProvider</code> interface.</p>
<ol>
<li>Send a request to the channel provider API, for example, <code>https://somechannelprovider.api/</code>, to retrieve data in the <code>SomeProviderProfileData</code> format. The <code>SomeProviderProfileData</code> format is a hypothetical messenger format.</li>
<li>Convert the received response into the internal <code>ProfileData</code> format.</li>
<li>Create a contact and add the retrieved data using the internal format. For example, first name, last name, and photo. If the request is unsuccessful or data is invalid, create a contact named <code>[New Contact][Channel]-[MessengerClientID]</code>.</li>
</ol>
<div class="language-cs codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockTitle_P25_>SomeProviderProfileData</div><div class=codeBlockContent_m3Ux><pre tabindex=0 class="prism-code language-cs codeBlock_qGQc thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_p187><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>namespace</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>Terrasoft</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Configuration</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Omnichannel</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Messaging</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>Newtonsoft</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Json</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>OmnichannelProviders</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Domain</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Entities</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>OmnichannelProviders</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Interfaces</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>System</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>IO</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>System</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Net</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>Terrasoft</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Core</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>public</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>class</span><span class="token plain"> </span><span class="token class-name">SomeProviderProfileData</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style=color:#00009f>string</span><span class="token plain"> first_name </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>get</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>set</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style=color:#00009f>string</span><span class="token plain"> last_name </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>get</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>set</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>region</span><span class="token preprocessor property" style=color:#36acaa> Class: SomeProviderProfileData</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>/* Retrieve the profile data from the "SomeProvider" provider. */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>public</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>class</span><span class="token plain"> </span><span class="token class-name">SomeProviderProfileData</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token type-list class-name">IProfileDataProvider</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>region</span><span class="token preprocessor property" style=color:#36acaa> Properties: Private </span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>private</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>readonly</span><span class="token plain"> </span><span class="token class-name keyword" style=color:#00009f>string</span><span class="token plain"> _someProviderUrl </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"https://somechannelprovider.api/"</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>endregion</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>region</span><span class="token preprocessor property" style=color:#36acaa> Constructors: Public </span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token comment" style=color:#999988;font-style:italic>/* Initialize a new "FacebookProfileDataProvider" class instance. */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>public</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>SomeProviderProfileData</span><span class="token punctuation" style=color:#393A34>(</span><span class="token class-name">UserConnection</span><span class="token plain"> userConnection</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>endregion</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>region</span><span class="token preprocessor property" style=color:#36acaa> Methods: Public</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token comment" style=color:#999988;font-style:italic>/* Retrieve the profile data from Facebook.</span><br></span><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>        The "profileId" parameter is the Facebook profile ID.</span><br></span><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>        The "channelId" parameter is the channel from which the request was sent.</span><br></span><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>        Return the contact ID. */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>public</span><span class="token plain"> </span><span class="token return-type class-name">ProfileData</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>GetProfileDataByProfileId</span><span class="token punctuation" style=color:#393A34>(</span><span class="token class-name keyword" style=color:#00009f>string</span><span class="token plain"> profileId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token class-name keyword" style=color:#00009f>string</span><span class="token plain"> channelId</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token class-name keyword" style=color:#00009f>var</span><span class="token plain"> requestUrl </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>string</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Concat</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">_someChannelProviderNameProviderApiUrl</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> profileId</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token class-name">WebRequest</span><span class="token plain"> request </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> WebRequest</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Create</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">requestUrl</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token keyword" style=color:#00009f>try</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token class-name keyword" style=color:#00009f>var</span><span class="token plain"> response </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>GetResponse</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token class-name">Stream</span><span class="token plain"> stream </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> response</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>GetResponseStream</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                        </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token class-name">StreamReader</span><span class="token plain"> sr </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">StreamReader</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">stream</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                            </span><span class="token class-name keyword" style=color:#00009f>var</span><span class="token plain"> someChannelProviderNameProfile </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> JsonConvert</span><span class="token punctuation" style=color:#393A34>.</span><span class="token generic-method function" style=color:#d73a49>DeserializeObject</span><span class="token generic-method generic class-name punctuation" style=color:#393A34>&lt;</span><span class="token generic-method generic class-name">SomeChannelProviderNameProfileData</span><span class="token generic-method generic class-name punctuation" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">sr</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>ReadToEnd</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                            </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">ProfileData</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                                FirstName </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> someChannelProviderNameProfile</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">first_name</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                                LastName </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> someChannelProviderNameProfile</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">last_name</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                            </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token keyword" style=color:#00009f>catch</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">ProfileData</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>endregion</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>endregion</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre><div class=buttonGroup_6DOT><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Publish the schema</strong>.</p>
</li>
</ol>
<p><strong>As a result</strong>, Creatio will retrieve the sender data and create contact using this data.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=title-15621-7>7. Implement downloading of attachments<a href=#title-15621-7 class=hash-link aria-label="Direct link to 7. Implement downloading of attachments" title="Direct link to 7. Implement downloading of attachments">​</a></h3>
<ol>
<li>
<p><strong>Create the source code schema</strong>. Instructions: <a href="https://academy.creatio.com/documents?ver=8.2&id=15108&anchor=title-2123-8" target=_blank rel="noopener noreferrer">Implement the source code</a>.</p>
</li>
<li>
<p><strong>Implement the business logic</strong> that lets you download attachments using the <code>IAttachmentsLoadWorker</code> interface. The class downloads the attachment via a link and saves the attachment to the <code>OmnichannelMessageFile</code> database table.</p>
<div class="language-cs codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockTitle_P25_>SomeProviderAttachmentLoadWorker</div><div class=codeBlockContent_m3Ux><pre tabindex=0 class="prism-code language-cs codeBlock_qGQc thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_p187><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>namespace</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>Terrasoft</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Configuration</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Omnichannel</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Messaging</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>OmnichannelProviders</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>OmnichannelProviders</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Domain</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Entities</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>OmnichannelProviders</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>MessageConverters</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>Terrasoft</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Core</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>region</span><span class="token preprocessor property" style=color:#36acaa> Class: SomeProviderAttachmentLoadWorker</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>/* Load attachments from the "SomeProvider" provider. */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>public</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>class</span><span class="token plain"> </span><span class="token class-name">SomeProviderAttachmentLoadWorker</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token type-list class-name">IAttachmentsLoadWorker</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>region</span><span class="token preprocessor property" style=color:#36acaa> Properties: Protected </span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>protected</span><span class="token plain"> </span><span class="token class-name">UserConnection</span><span class="token plain"> UserConnection</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>protected</span><span class="token plain"> </span><span class="token class-name">AttachmentsDownloader</span><span class="token plain"> AttachmentsDownloader</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>endregion</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>region</span><span class="token preprocessor property" style=color:#36acaa> Constructors: Public</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token comment" style=color:#999988;font-style:italic>/* Initialize a new "SomeProviderAttachmentLoadWorker" class instance. */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>public</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>SomeProviderAttachmentLoadWorker</span><span class="token punctuation" style=color:#393A34>(</span><span class="token class-name">UserConnection</span><span class="token plain"> userConnection</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            UserConnection </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> userConnection</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            AttachmentsDownloader </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">AttachmentsDownloader</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">userConnection</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>endregion</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>region</span><span class="token preprocessor property" style=color:#36acaa> Methods: Public </span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token comment" style=color:#999988;font-style:italic>/* Load the attachments.</span><br></span><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>        The "incomeAttachment" parameter is the attachment from the messenger.</span><br></span><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>        The "message" parameter is the source message. */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style=color:#00009f>void</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>Load</span><span class="token punctuation" style=color:#393A34>(</span><span class="token class-name">MessageAttachment</span><span class="token plain"> incomeAttachment</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token class-name">UnifiedMessage</span><span class="token plain"> message</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            incomeAttachment</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">FileName </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> FileUtilities</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>GetFileNameFromUrl</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">incomeAttachment</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">UploadUrl</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            incomeAttachment</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">FileId </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> AttachmentsDownloader</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Load</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">incomeAttachment</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>endregion</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>endregion</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre><div class=buttonGroup_6DOT><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Publish the schema</strong>.</p>
</li>
</ol>
<p><strong>As a result</strong>, users will be able to download attachments.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=title-15621-8>8. Implement sending of messages<a href=#title-15621-8 class=hash-link aria-label="Direct link to 8. Implement sending of messages" title="Direct link to 8. Implement sending of messages">​</a></h3>
<ol>
<li>
<p><strong>Create the source code schema</strong>. Instructions: <a href="https://academy.creatio.com/documents?ver=8.2&id=15108&anchor=title-2123-8" target=_blank rel="noopener noreferrer">Implement the source code</a>.</p>
</li>
<li>
<p><strong>Implement the business logic</strong> that sends messages using the <code>IOutcomeMessageWorker</code> interface.</p>
<ol>
<li>Convert the message to messenger format and send it using the messenger API.</li>
<li>Send the message using a token. Store the token in the <code>SomeChannelProviderNameMsgSettings</code> database table.</li>
<li><code>UserConnection</code> sent in the constructor provides access to the database table.</li>
<li>Send a message to the channel provider API, for example, <code>https://somechannelprovider.api/</code>, using the <code>HttpRequestSender</code> class.</li>
</ol>
<div class="language-cs codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockTitle_P25_>SomeProviderOutcomeMessageWorker</div><div class=codeBlockContent_m3Ux><pre tabindex=0 class="prism-code language-cs codeBlock_qGQc thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_p187><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>namespace</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>Terrasoft</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Configuration</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Omnichannel</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Messaging</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>Newtonsoft</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Json</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>Newtonsoft</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Json</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Serialization</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>OmnichannelProviders</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Application</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Http</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>OmnichannelProviders</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Domain</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Entities</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>OmnichannelProviders</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>MessageWorkers</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>Terrasoft</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Core</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>region</span><span class="token preprocessor property" style=color:#36acaa> Class: SomeProviderOutcomeMessageWorker</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>/* Send messages to the "SomeProvider" provider. */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>public</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>class</span><span class="token plain"> </span><span class="token class-name">SomeProviderOutcomeMessageWorker</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token type-list class-name">IOutcomeMessageWorker</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>region</span><span class="token preprocessor property" style=color:#36acaa> Properties: Protected </span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>protected</span><span class="token plain"> </span><span class="token class-name">UserConnection</span><span class="token plain"> UserConnection</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>private</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>readonly</span><span class="token plain"> </span><span class="token class-name keyword" style=color:#00009f>string</span><span class="token plain"> _someChannelProviderNameProviderApiUrl </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"https://somechannelprovider.api"</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>endregion</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>region</span><span class="token preprocessor property" style=color:#36acaa> Constructors: Public</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token comment" style=color:#999988;font-style:italic>/* Initialize a new "SomeProviderOutcomeMessageWorker" class instance. */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>public</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>SomeProviderOutcomeMessageWorker</span><span class="token punctuation" style=color:#393A34>(</span><span class="token class-name">UserConnection</span><span class="token plain"> userConnection</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            UserConnection </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> userConnection</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>endregion</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>region</span><span class="token preprocessor property" style=color:#36acaa> Methods: Public</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token comment" style=color:#999988;font-style:italic>/* Send the message to the "SomeProvider" provider.</span><br></span><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>        The "message" parameter is the unified message. */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style=color:#00009f>string</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>SendMessage</span><span class="token punctuation" style=color:#393A34>(</span><span class="token class-name">UnifiedMessage</span><span class="token plain"> unifiedMessage</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>out</span><span class="token plain"> </span><span class="token class-name keyword" style=color:#00009f>bool</span><span class="token plain"> success</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token class-name keyword" style=color:#00009f>var</span><span class="token plain"> serializerSettings </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">JsonSerializerSettings</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            serializerSettings</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">ContractResolver </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">CamelCasePropertyNamesContractResolver</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token class-name keyword" style=color:#00009f>var</span><span class="token plain"> json </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> JsonConvert</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>SerializeObject</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">unifiedMessage</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> serializerSettings</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token class-name keyword" style=color:#00009f>var</span><span class="token plain"> requestUrl </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>string</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Concat</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">_someChannelProviderNameProviderApiUrl</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> json</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token class-name keyword" style=color:#00009f>var</span><span class="token plain"> result </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">HttpRequestSender</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>PostAsync</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">requestUrl</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> json</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Result</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            success </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>true</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> result</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style=color:#00009f>string</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>PassControlToPrimaryReceiver</span><span class="token punctuation" style=color:#393A34>(</span><span class="token class-name">UnifiedMessage</span><span class="token plain"> message</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>string</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Empty</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>endregion</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>endregion</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre><div class=buttonGroup_6DOT><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Publish the schema</strong>.</p>
</li>
</ol>
<p><strong>As a result</strong>, users will be able to send messages.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=title-15621-9>9. Link the interfaces<a href=#title-15621-9 class=hash-link aria-label="Direct link to 9. Link the interfaces" title="Direct link to 9. Link the interfaces">​</a></h3>
<ol>
<li>
<p><strong>Create the source code schema</strong>. Instructions: <a href="https://academy.creatio.com/documents?ver=8.2&id=15108&anchor=title-2123-8" target=_blank rel="noopener noreferrer">Implement the source code</a>.</p>
</li>
<li>
<p><strong>Implement the business logic</strong> that links interfaces.</p>
<ol>
<li>Specify the <code>AppEventListenerBase</code> class as a parent class.</li>
<li>Link the created classes using the <code>SomeProvider</code> provider ID that is specified in the <code>ChannelName</code> property of the business logic handling incoming messages. Creatio uses a provider ID to identify the files required to retrieve profile data, upload attachments, and send messages.</li>
</ol>
<div class="language-cs codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockTitle_P25_>SomeProviderAppEventListener</div><div class=codeBlockContent_m3Ux><pre tabindex=0 class="prism-code language-cs codeBlock_qGQc thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_p187><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>namespace</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>Terrasoft</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Configuration</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Omnichannel</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Messaging</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>Common</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>Core</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>OmnichannelProviders</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>OmnichannelProviders</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Interfaces</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>OmnichannelProviders</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>MessageWorkers</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>Terrasoft</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Core</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Factories</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>Web</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Common</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>region</span><span class="token preprocessor property" style=color:#36acaa> Class : SomeProviderAppEventListener</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>/* Run prerequisites for "OmnichannelMessaging" on app start. */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>public</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>class</span><span class="token plain"> </span><span class="token class-name">SomeProviderAppEventListener</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token type-list class-name">AppEventListenerBase</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>region</span><span class="token preprocessor property" style=color:#36acaa> Fields : Protected</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>protected</span><span class="token plain"> </span><span class="token return-type class-name">UserConnection</span><span class="token plain"> UserConnection </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token keyword" style=color:#00009f>get</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token keyword" style=color:#00009f>private</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>set</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>endregion</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>region</span><span class="token preprocessor property" style=color:#36acaa> Methods : Protected</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token comment" style=color:#999988;font-style:italic>/* Retrieve the user connection from the app event scope.</span><br></span><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>        The "context" parameter is the app event scope.</span><br></span><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>        Return user connection. */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>protected</span><span class="token plain"> </span><span class="token return-type class-name">UserConnection</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>GetUserConnection</span><span class="token punctuation" style=color:#393A34>(</span><span class="token class-name">AppEventContext</span><span class="token plain"> context</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token class-name keyword" style=color:#00009f>var</span><span class="token plain"> appConnection </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> context</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Application</span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>"AppConnection"</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>as</span><span class="token plain"> </span><span class="token class-name">AppConnection</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">appConnection </span><span class="token operator" style=color:#393A34>==</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>null</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                </span><span class="token keyword" style=color:#00009f>throw</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">ArgumentNullOrEmptyException</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"AppConnection"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> appConnection</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">SystemUserConnection</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>protected</span><span class="token plain"> </span><span class="token return-type class-name keyword" style=color:#00009f>void</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>BindInterfaces</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            ClassFactory</span><span class="token punctuation" style=color:#393A34>.</span><span class="token generic-method function" style=color:#d73a49>Bind</span><span class="token generic-method generic class-name punctuation" style=color:#393A34>&lt;</span><span class="token generic-method generic class-name">IAttachmentsLoadWorker</span><span class="token generic-method generic class-name punctuation" style=color:#393A34>,</span><span class="token generic-method generic class-name"> SomeChannelProviderNameAttachmentLoadWorker</span><span class="token generic-method generic class-name punctuation" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">ChannelType</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">ThirdParty</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>ToString</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            ClassFactory</span><span class="token punctuation" style=color:#393A34>.</span><span class="token generic-method function" style=color:#d73a49>Bind</span><span class="token generic-method generic class-name punctuation" style=color:#393A34>&lt;</span><span class="token generic-method generic class-name">IProfileDataProvider</span><span class="token generic-method generic class-name punctuation" style=color:#393A34>,</span><span class="token generic-method generic class-name"> SomeChannelProviderNameProfileDataProvider</span><span class="token generic-method generic class-name punctuation" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">ChannelType</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">ThirdParty</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>ToString</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            ClassFactory</span><span class="token punctuation" style=color:#393A34>.</span><span class="token generic-method function" style=color:#d73a49>Bind</span><span class="token generic-method generic class-name punctuation" style=color:#393A34>&lt;</span><span class="token generic-method generic class-name">IOutcomeMessageWorker</span><span class="token generic-method generic class-name punctuation" style=color:#393A34>,</span><span class="token generic-method generic class-name"> SomeChannelProviderNameOutcomeMessageWorker</span><span class="token generic-method generic class-name punctuation" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">ChannelType</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">ThirdParty</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>ToString</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>endregion</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>region</span><span class="token preprocessor property" style=color:#36acaa> Methods : Public</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token comment" style=color:#999988;font-style:italic>/* Handle the app start.</span><br></span><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>        The "context" parameter is the app event scope. */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>public</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>override</span><span class="token plain"> </span><span class="token return-type class-name keyword" style=color:#00009f>void</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>OnAppStart</span><span class="token punctuation" style=color:#393A34>(</span><span class="token class-name">AppEventContext</span><span class="token plain"> context</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token keyword" style=color:#00009f>base</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>OnAppStart</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">context</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            UserConnection </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>GetUserConnection</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">context</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token function" style=color:#d73a49>BindInterfaces</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>endregion</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>endregion</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre><div class=buttonGroup_6DOT><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Publish the schema</strong>.</p>
</li>
</ol>
<p><strong>As a result</strong>, the custom channel provider will be implemented.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=title-15621-10>Implement a custom chat routing rule<a href=#title-15621-10 class=hash-link aria-label="Direct link to Implement a custom chat routing rule" title="Direct link to Implement a custom chat routing rule">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=title-15621-11>1. Add a chat routing rule to Creatio<a href=#title-15621-11 class=hash-link aria-label="Direct link to 1. Add a chat routing rule to Creatio" title="Direct link to 1. Add a chat routing rule to Creatio">​</a></h3>
<ol>
<li>
<p><strong>Create a user-made package</strong> to add the chat routing rule. To do this, click <img decoding=async loading=lazy src=https://d3a7ykdi65m4cy.cloudfront.net/ac-en/s3fs-public/documentation/sdk/en/BPMonlineWebSDK/Screenshots/CreateConfigurationWebService/8.1/btn_create_a_package.png alt="" class=img_ev3q> → <strong>Create new package</strong> → fill out the package properties → <strong>Save</strong>.</p>
</li>
<li>
<p><strong>Change the current package</strong>. Instructions: <a href="https://academy.creatio.com/documents?ver=8.2&id=15072&anchor=change-the-current-package" target=_blank rel="noopener noreferrer">Change the current package</a>.</p>
</li>
<li>
<p><strong>Open the Lookups section</strong>. To do this, click <img decoding=async loading=lazy src=https://d3a7ykdi65m4cy.cloudfront.net/ac-en/s3fs-public/documentation/sdk/en/BPMonlineWebSDK/Screenshots/icons/8.2/btn_system_designer.png alt="" class=img_ev3q> in the top right → <strong>System setup</strong> → <strong>Lookups</strong>.</p>
</li>
<li>
<p><strong>Open the Rules for routing chat queue operators lookup</strong>.</p>
</li>
<li>
<p><strong>Add the lookup value</strong>. To do this, click <strong>New</strong>.</p>
</li>
<li>
<p><strong>Fill out the properties</strong> of the lookup value.</p>
<p>View the example that adds the "Some custom chat routing rule" chat routing rule below.</p>
<table><tr><th><p>Property<th><p>Property value<tr><td><center><p>Name</center><td><center><p>Some custom chat routing rule</center><tr><td><center><p>Code</center><td><center><p>SomeCustomChatRoutingRule</center></table>
</li>
<li>
<p><strong>Save the changes</strong>.</p>
</li>
</ol>
<p><strong>As a result</strong>, the custom chat routing rule will be added to Creatio.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=title-15621-12>2. Implement routing of chats<a href=#title-15621-12 class=hash-link aria-label="Direct link to 2. Implement routing of chats" title="Direct link to 2. Implement routing of chats">​</a></h3>
<ol>
<li>
<p><strong>Create the source code schema</strong>. Instructions: <a href="https://academy.creatio.com/documents?ver=8.2&id=15108&anchor=title-2123-8" target=_blank rel="noopener noreferrer">Implement the source code</a>.</p>
</li>
<li>
<p><strong>Create a service class</strong>.</p>
<ol>
<li>Add the <code>Terrasoft.Configuration.Omnichannel.Messaging</code> namespace.</li>
<li>Add the namespaces the data types of which to utilize in the class using the <code>using</code> directive.</li>
<li>Add a class name that matches the schema name (the <strong>Code</strong> property).</li>
<li>Specify the <code>BaseOperatorRoutingRule</code> class as a parent class.</li>
</ol>
</li>
<li>
<p><strong>Implement a class method</strong>.</p>
<ol>
<li>Add the <code>public CustomChatRoutingRule(UserConnection userConnection)</code> method that routes the chat.</li>
<li>Add the <code>protected override List&lt;Guid> PickUpFreeQueueOperators(Guid chatId, Guid queueId)</code> method that matches agent IDs to chat IDs. If the chat is already assigned to an agent (the <code>[OperatorId]</code> column includes the user ID), select the agent. Otherwise, retrieve the agent or agents as <code>List&lt;Guid></code>, where <code>Guid</code> stores a list of agent IDs in the <code>SysAdminUnit</code> database table. The agents that have the corresponding IDs receive new chat notifications and can access the chat using the communication panel. ID of the  Supervisor system user is specified in the <img decoding=async loading=lazy src=https://d3a7ykdi65m4cy.cloudfront.net/ac-en/s3fs-public/documentation/sdk/en/BPMonlineWebSDK/Screenshots/icons/8.2/btn_system_designer.png alt="" class=img_ev3q> → <strong>Users and administration</strong> → <strong>Users</strong> section → <strong>Id</strong> column. For this example, the ID is "7f3b869f-34f3-4f20-ab4d-7480a5fdf647."</li>
<li>Add the <code>protected override Guid GetChatOperator(Guid chatId)</code> method that returns agent ID using chat ID.</li>
</ol>
<p>View the example that routes the chat to the Supervisor system user whose ID is "7f3b869f-34f3-4f20-ab4d-7480a5fdf647." below.</p>
<div class="language-cs codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockTitle_P25_>SomeChatRouting</div><div class=codeBlockContent_m3Ux><pre tabindex=0 class="prism-code language-cs codeBlock_qGQc thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_p187><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>namespace</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>Terrasoft</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Configuration</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Omnichannel</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Messaging</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>System</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>System</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Collections</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Generic</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>Terrasoft</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Core</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>Terrasoft</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Core</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>DB</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>region</span><span class="token preprocessor property" style=color:#36acaa> Class: SomeChatRouting</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>public</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>class</span><span class="token plain"> </span><span class="token class-name">SomeChatRouting</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token type-list class-name">BaseOperatorRoutingRule</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>region</span><span class="token preprocessor property" style=color:#36acaa> Constructors: Public</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>/* Route the chat to the Supervisor system user. */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>public</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>CustomChatRoutingRule</span><span class="token punctuation" style=color:#393A34>(</span><span class="token class-name">UserConnection</span><span class="token plain"> userConnection</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>base</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">userConnection</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>endregion</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>region</span><span class="token preprocessor property" style=color:#36acaa> Methods: Protected</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>/* Match agent IDs to chat IDs. */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>protected</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>override</span><span class="token plain"> </span><span class="token return-type class-name">List</span><span class="token return-type class-name punctuation" style=color:#393A34>&lt;</span><span class="token return-type class-name">Guid</span><span class="token return-type class-name punctuation" style=color:#393A34>></span><span class="token plain"> </span><span class="token function" style=color:#d73a49>PickUpFreeQueueOperators</span><span class="token punctuation" style=color:#393A34>(</span><span class="token class-name">Guid</span><span class="token plain"> chatId</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token class-name">Guid</span><span class="token plain"> queueId</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">List</span><span class="token constructor-invocation class-name punctuation" style=color:#393A34>&lt;</span><span class="token constructor-invocation class-name">Guid</span><span class="token constructor-invocation class-name punctuation" style=color:#393A34>></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token comment" style=color:#999988;font-style:italic>/* ID of Supervisor system user. */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            Guid</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Parse</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"7f3b869f-34f3-4f20-ab4d-7480a5fdf647"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>/* Return agent ID using chat ID. */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>protected</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>override</span><span class="token plain"> </span><span class="token return-type class-name">Guid</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>GetChatOperator</span><span class="token punctuation" style=color:#393A34>(</span><span class="token class-name">Guid</span><span class="token plain"> chatId</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token class-name">Guid</span><span class="token plain"> operatorId </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">Select</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">UserConnection</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Column</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"OperatorId"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>From</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"OmniChat"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"oc"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Where</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"oc"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Id"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>IsEqual</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">Column</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>Parameter</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">chatId</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>as</span><span class="token plain"> </span><span class="token class-name">Select</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token generic-method function" style=color:#d73a49>ExecuteScalar</span><span class="token generic-method generic class-name punctuation" style=color:#393A34>&lt;</span><span class="token generic-method generic class-name">Guid</span><span class="token generic-method generic class-name punctuation" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> operatorId</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>endregion</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>endregion</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre><div class=buttonGroup_6DOT><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Publish the schema</strong>.</p>
</li>
</ol>
<p><strong>As a result</strong>, Creatio will route chats to the dedicated user.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=title-15621-13>3. Link the interfaces<a href=#title-15621-13 class=hash-link aria-label="Direct link to 3. Link the interfaces" title="Direct link to 3. Link the interfaces">​</a></h3>
<ol>
<li>
<p><strong>Create the source code schema</strong>. Instructions: <a href="https://academy.creatio.com/documents?ver=8.2&id=15108&anchor=title-2123-8" target=_blank rel="noopener noreferrer">Implement the source code</a>.</p>
</li>
<li>
<p><strong>Implement the business logic</strong> that links interfaces.</p>
<ol>
<li>Specify the <code>AppEventListenerBase</code> class as a parent class.</li>
<li>Link the created class using the <code>SomeCustomChatRoutingRule</code> chat routing rule that is specified in the <strong>Rules for routing chat queue operators</strong> lookup.</li>
</ol>
<div class="language-cs codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockTitle_P25_>SomeAppEventListener</div><div class=codeBlockContent_m3Ux><pre tabindex=0 class="prism-code language-cs codeBlock_qGQc thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_p187><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>namespace</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>Terrasoft</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Configuration</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Omnichannel</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Messaging</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>Common</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>Core</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>Terrasoft</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Core</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Factories</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>using</span><span class="token plain"> </span><span class="token namespace" style=opacity:0.7>Web</span><span class="token namespace punctuation" style=opacity:0.7;color:#393A34>.</span><span class="token namespace" style=opacity:0.7>Common</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>region</span><span class="token preprocessor property" style=color:#36acaa> Class: SomeAppEventListener</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>/* Run prerequisites for "OmnichannelMessaging" on app start. */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>public</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>class</span><span class="token plain"> </span><span class="token class-name">SomeAppEventListener</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token type-list class-name">AppEventListenerBase</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>region</span><span class="token preprocessor property" style=color:#36acaa> Fields: Protected</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>protected</span><span class="token plain"> </span><span class="token return-type class-name">UserConnection</span><span class="token plain"> UserConnection </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token keyword" style=color:#00009f>get</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token keyword" style=color:#00009f>private</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>set</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>endregion</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>region</span><span class="token preprocessor property" style=color:#36acaa> Methods: Protected</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token comment" style=color:#999988;font-style:italic>/* Retrieve the user connection from the app event scope.</span><br></span><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>        The "context" parameter is the app event scope.</span><br></span><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>        Return user connection. */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>protected</span><span class="token plain"> </span><span class="token return-type class-name">UserConnection</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>GetUserConnection</span><span class="token punctuation" style=color:#393A34>(</span><span class="token class-name">AppEventContext</span><span class="token plain"> context</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token class-name keyword" style=color:#00009f>var</span><span class="token plain"> appConnection </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> context</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">Application</span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>"AppConnection"</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>as</span><span class="token plain"> </span><span class="token class-name">AppConnection</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">appConnection </span><span class="token operator" style=color:#393A34>==</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>null</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                </span><span class="token keyword" style=color:#00009f>throw</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">ArgumentNullOrEmptyException</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"AppConnection"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> appConnection</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">SystemUserConnection</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>protected</span><span class="token plain"> </span><span class="token return-type class-name keyword" style=color:#00009f>void</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>BindInterfaces</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            ClassFactory</span><span class="token punctuation" style=color:#393A34>.</span><span class="token generic-method function" style=color:#d73a49>Bind</span><span class="token generic-method generic class-name punctuation" style=color:#393A34>&lt;</span><span class="token generic-method generic class-name">IOperatorRoutingRule</span><span class="token generic-method generic class-name punctuation" style=color:#393A34>,</span><span class="token generic-method generic class-name"></span><br></span><span class=token-line style=color:#393A34><span class="token generic-method generic class-name">            TestOperatorRoutingRule</span><span class="token generic-method generic class-name punctuation" style=color:#393A34>></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"SomeCustomChatRoutingRule"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>endregion</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>region</span><span class="token preprocessor property" style=color:#36acaa> Methods: Public</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token comment" style=color:#999988;font-style:italic>/* Handle the app start.</span><br></span><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>        The "context" parameter is the app event scope. */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>public</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>override</span><span class="token plain"> </span><span class="token return-type class-name keyword" style=color:#00009f>void</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>OnAppStart</span><span class="token punctuation" style=color:#393A34>(</span><span class="token class-name">AppEventContext</span><span class="token plain"> context</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token keyword" style=color:#00009f>base</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>OnAppStart</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">context</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            UserConnection </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>GetUserConnection</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">context</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token function" style=color:#d73a49>BindInterfaces</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>endregion</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token preprocessor property" style=color:#36acaa>#</span><span class="token preprocessor property directive keyword" style=color:#00009f>endregion</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre><div class=buttonGroup_6DOT><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Publish the schema</strong>.</p>
</li>
</ol>
<p><strong>As a result</strong>, the custom chat routing rule will be implemented.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=title-15621-14>4. Restart Creatio in IIS<a href=#title-15621-14 class=hash-link aria-label="Direct link to 4. Restart Creatio in IIS" title="Direct link to 4. Restart Creatio in IIS">​</a></h3>
<p>Restart Creatio in IIS to apply the changes.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=title-15621-15>5. Include the custom chat routing rule in the chat distribution mechanism​<a href=#title-15621-15 class=hash-link aria-label="Direct link to 5. Include the custom chat routing rule in the chat distribution mechanism​" title="Direct link to 5. Include the custom chat routing rule in the chat distribution mechanism​">​</a></h3>
<ol>
<li>
<p><strong>Open the Chat settings section</strong>. To do this, click <img decoding=async loading=lazy src=https://d3a7ykdi65m4cy.cloudfront.net/ac-en/s3fs-public/documentation/sdk/en/BPMonlineWebSDK/Screenshots/icons/8.2/btn_system_designer.png alt="" class=img_ev3q> in the top right → <strong>Import and integration</strong> → <strong>Chat settings</strong>.</p>
</li>
<li>
<p><strong>Add the custom chat routing rule</strong> to the chat queues. To do this, go to the <strong>Chat queues</strong> expanded list and click <img decoding=async loading=lazy src=https://d3a7ykdi65m4cy.cloudfront.net/ac-en/s3fs-public/documentation/sdk/en/BPMonlineWebSDK/Screenshots/icons/8.2/btn_add.png alt="" class=img_ev3q>.</p>
</li>
<li>
<p><strong>Fill out the properties</strong> of the custom chat routing rule.</p>
<table><tr><th><p>Property<th><p>Property value<tr><td><center><p>Name<font color=#FF0000>*</font></center><td><center><p>An arbitrary name of a custom chat routing rule. For example, "Some custom chat distribution mechanism."</center><tr><td><center><p>Routing rule<font color=#FF0000>*</font></center><td><center><p>The way chats will be distributed to agents. For example, "Some custom chat routing rule."</center><tr><td><center><p>Queue agents<font color=#FF0000>*</font></center><td><ol>
<li>Click <img decoding=async loading=lazy src=https://d3a7ykdi65m4cy.cloudfront.net/ac-en/s3fs-public/documentation/sdk/en/BPMonlineWebSDK/Screenshots/icons/8.2/btn_add.png alt="" class=img_ev3q>. This opens the <strong>Select user or role</strong> window.</li>
<li>Open the  <strong>Organizational roles</strong>, <strong>Functional roles</strong> or <strong>Users</strong> tab based on your business goals.</li>
<li>Select roles and/or users.</li>
<li>Click <strong>Select</strong>.</li>
</ol></table>
</li>
</ol>
<p><strong>As a result</strong>, the custom chat routing rule will be implemented and Creatio will route new chats to selected roles and/or users using custom chat routing rule.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=see-also>See also<a href=#see-also class=hash-link aria-label="Direct link to See also" title="Direct link to See also">​</a></h2>
<p><a href="https://academy.creatio.com/documents?ver=8.2&id=15108" target=_blank rel="noopener noreferrer">Configuration elements of the Source code type</a></p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=resources>Resources<a href=#resources class=hash-link aria-label="Direct link to Resources" title="Direct link to Resources">​</a></h2>
<p><a href=https://academy.creatio.com/docs/8.x/no-code-customization/category/chat-setup target=_blank rel="noopener noreferrer">Chat setup</a> (user documentation)</div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/docs/8.x/dev/development-on-creatio-platform/8.2/category/chats><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Chats</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/docs/8.x/dev/development-on-creatio-platform/8.2/chat-references><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>References</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#title-3480-1 class="table-of-contents__link toc-highlight">Manage chat functionality in Creatio</a><li><a href=#title-3480-16 class="table-of-contents__link toc-highlight">Implement a custom channel provider</a><ul><li><a href=#title-15621-1 class="table-of-contents__link toc-highlight">1. Add a channel provider to Creatio</a><li><a href=#title-15621-2 class="table-of-contents__link toc-highlight">2. Create a database table to store data of the custom channel provider</a><li><a href=#title-15621-3 class="table-of-contents__link toc-highlight">3. Register the custom channel provider in the database</a><li><a href=#title-15621-4 class="table-of-contents__link toc-highlight">4. Implement a custom web service that receives messages</a><li><a href=#title-15621-5 class="table-of-contents__link toc-highlight">5. Handle an incoming message</a><li><a href=#title-15621-6 class="table-of-contents__link toc-highlight">6. Implement retrieval of sender data</a><li><a href=#title-15621-7 class="table-of-contents__link toc-highlight">7. Implement downloading of attachments</a><li><a href=#title-15621-8 class="table-of-contents__link toc-highlight">8. Implement sending of messages</a><li><a href=#title-15621-9 class="table-of-contents__link toc-highlight">9. Link the interfaces</a></ul><li><a href=#title-15621-10 class="table-of-contents__link toc-highlight">Implement a custom chat routing rule</a><ul><li><a href=#title-15621-11 class="table-of-contents__link toc-highlight">1. Add a chat routing rule to Creatio</a><li><a href=#title-15621-12 class="table-of-contents__link toc-highlight">2. Implement routing of chats</a><li><a href=#title-15621-13 class="table-of-contents__link toc-highlight">3. Link the interfaces</a><li><a href=#title-15621-14 class="table-of-contents__link toc-highlight">4. Restart Creatio in IIS</a><li><a href=#title-15621-15 class="table-of-contents__link toc-highlight">5. Include the custom chat routing rule in the chat distribution mechanism​</a></ul><li><a href=#see-also class="table-of-contents__link toc-highlight">See also</a><li><a href=#resources class="table-of-contents__link toc-highlight">Resources</a></ul></div></div></div></div></main></div></div></div></div><footer class=footer><div class=footer__top><div class="container container-fluid"><div class=footer__cont><div class=footer__logo><img src=/docs/8.x/dev/img/accelerate.svg alt="" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE" width=271.4 height=38><img src=/docs/8.x/dev/img/accelerate.svg alt="" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU" width=271.4 height=38></div><div class="row footer__links"><div class="col footer__col"><ul class="footer__items clean-list"><li class=footer__item><a href=https://www.facebook.com/CreatioCompany target=_blank rel="noopener noreferrer" class=footer__link-item>Facebook<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.linkedin.com/company/creatioglobal target=_blank rel="noopener noreferrer" class=footer__link-item>LinkedIn<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.youtube.com/c/creatio target=_blank rel="noopener noreferrer" class=footer__link-item>YouTube<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.twitter.com/Creatio_Global target=_blank rel="noopener noreferrer" class=footer__link-item>Twitter<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://www.owler.com/company/Creatio target=_blank rel="noopener noreferrer" class=footer__link-item>Owler<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a></ul></div><div class="col footer__col"><div class=footer__title>Connect with us</div><ul class="footer__items clean-list"><li class=footer__item><a href="tel:+1 617 765 7997" target=_blank rel="noopener noreferrer" class=footer__link-item>US: +1 617 765 7997</a><li class=footer__item><a href="tel:+44 20 3384 0040" target=_blank rel="noopener noreferrer" class=footer__link-item>UK: +44 20 3384 0040</a><li class=footer__item><a href="tel:+61 261 452 888" target=_blank rel="noopener noreferrer" class=footer__link-item>AU: +61 261 452 888</a></ul></div><div class="col footer__col"><div class=footer__title> </div><ul class="footer__items clean-list"><li class=footer__item><a href=mailto:info@creatio.com target=_blank rel="noopener noreferrer" class=footer__link-item>info@creatio.com</a><li class=footer__item><a href=mailto:info@creatio.com target=_blank rel="noopener noreferrer" class=footer__link-item>support@creatio.com</a></ul></div></div></div></div></div><div class=footer__bottom><div class="container container-fluid"><div class=footer__copyright>© 2025 Creatio. All rights reserved.  |  <a href=https://www.creatio.com/privacy-policy target=_blank>Privacy Policy</a></div></div></div></footer></div>